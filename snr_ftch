import requests
import pandas as pd

# Constants
INPUT_FILE = "Hotspots.xlsx"
OUTPUT_FILE = "Output_hotspots.xlsx"
API_URL = "https://sonar.crm.com/api/hotspots/show?hotspot="
HEADERS = {"Authorization": "Bearer sjjsjnss"}

# Load input Excel file
df = pd.read_excel(INPUT_FILE, usecols=[0], names=["key"])

# Function to fetch data from API
def fetch_hotspot_data(hotspot_key):
    response = requests.get(API_URL + hotspot_key, headers=HEADERS)
    if response.status_code == 200:
        data = response.json()
        return {
            "key": hotspot_key,
            "login": data.get("login", ""),
            "markdown": data.get("markdown", ""),
            "status": data.get("status", ""),
            "newValue": data.get("newValue", "")
        }
    else:
        return {"key": hotspot_key, "login": "", "markdown": "", "status": "", "newValue": ""}

# Fetch data for all keys
output_data = [fetch_hotspot_data(row["key"]) for _, row in df.iterrows()]

# Save to new Excel file
output_df = pd.DataFrame(output_data)
output_df.to_excel(OUTPUT_FILE, index=False)

print(f"Data saved to {OUTPUT_FILE}")